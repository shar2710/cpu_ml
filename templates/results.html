{% extends "layout.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8 offset-md-2">
        <div class="text-center">
            <h1>Simulation Results</h1>
            <p class="lead">Comparing RL-based scheduler performance with traditional scheduling algorithms</p>
        </div>
    </div>
</div>

<!-- Key Metrics Overview -->
<div class="row mb-5">
    <div class="col-md-10 offset-md-1">
        <div class="card1">
            <div class="card1-title">
                <h2>Key Performance Metrics</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for scheduler, data in results.items() %}
                    <div class="col-md-3 mb-4">
                        <div class="card h-100 scheduler-card scheduler-{{ scheduler }} bg-dark border-{{ 'primary' if scheduler == 'RL' else 'light' }}">
                            <div class="card-header {{ 'text-primary' if scheduler == 'RL' else '' }}">{{ scheduler }} Scheduler</div>
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <p class="text-muted mb-1">Average Latency</p>
                                    <p class="metric-value">{{ "%.2f"|format(data.avg_latency) }}</p>
                                    <p class="metric-unit">ms</p>
                                </div>
                                <div class="mb-3">
                                    <p class="text-muted mb-1">Throughput</p>
                                    <p class="metric-value">{{ "%.2f"|format(data.throughput) }}</p>
                                    <p class="metric-unit">tasks/s</p>
                                </div>
                                <div class="mb-3">
                                    <p class="text-muted mb-1">CPU Utilization</p>
                                    <p class="metric-value">{{ "%.1f"|format(data.cpu_utilization * 100) }}</p>
                                    <p class="metric-unit">%</p>
                                </div>
                                <div>
                                    <p class="text-muted mb-1">Completed Tasks</p>
                                    <p class="metric-value">{{ data.completed_tasks }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- RL Training Results -->
{% if training_plot %}
<div class="row mb-5">
    <div class="col-md-10 offset-md-1">
        <div class="card1">
            <div class="card1-body">
                <h2>Training Performance</h2>
            </div>
            <div class="card1-body">
                <div class="row">
                    <div class="col-md-8 offset-md-2">
                        <img src="data:image/png;base64,{{ training_plot }}" class="img-fluid" 
                             alt="Training Rewards Plot">
                    </div>
                </div>
                <div class="card1-title
                    <div class="card1-body">
                        <p class="text-gray-800">
                            The graph above shows how the cumulative reward improved as the RL agent learned
                            the optimal scheduling policy over training episodes.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Performance Comparison Charts -->
<div class="row mb-5">
    <div class="col-md-10 offset-md-1">
        <div class="card1">
            <div class="card1-body">
                <h2>Performance Comparison</h2>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="chart-container">
                            <canvas id="latencyChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="chart-container">
                            <canvas id="throughputChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="chart-container">
                            <canvas id="utilizationChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8 offset-md-2">
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Action Buttons -->
<div class="row mb-5">
    <div class="col-md-10 offset-md-1">
        <div class="d-flex justify-content-between">
            <div>
                <a href="{{ url_for('simulation') }}" class="btn btn-outline-primary me-2">
                    <i class="fas fa-sliders-h me-2"></i>Modify Parameters
                </a>
                <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#saveResultsModal">
                    <i class="fas fa-save me-2"></i>Save to Database
                </button>
            </div>
            <div>
                <a href="{{ url_for('db_management') }}" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-database me-2"></i>Database Management
                </a>
                <a href="{{ url_for('simulation') }}?train=true" class="btn btn-primary">
                    <i class="fas fa-sync-alt me-2"></i>Run New Simulation
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Save Results Modal -->
<div class="modal fade" id="saveResultsModal" tabindex="-1" aria-labelledby="saveResultsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="saveResultsModalLabel">Save Current Results</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{{ url_for('save_current_results') }}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="result-config-name" class="form-label">Configuration Name</label>
                        <input type="text" class="form-control" id="result-config-name" name="config_name" 
                               value="Simulation {{ now().strftime('%Y-%m-%d %H:%M') }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="result-description" class="form-label">Description</label>
                        <textarea class="form-control" id="result-description" name="description" rows="3" 
                                  placeholder="Enter a description of this simulation run..."></textarea>
                    </div>
                    <div class="alert alert-info">
                        All current simulation results will be saved along with the current configuration.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Results</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
